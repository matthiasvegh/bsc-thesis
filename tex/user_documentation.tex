\chapter{User Documentation}
\label{chapter:UserDoc}

\newread\ownread
\newcommand{\piprequirements}[1]{
	\IfFileExists{#1}{
		\openin\ownread=#1
		\begin{inparaitem}
			\loop\unless\ifeof\ownread
			\read\ownread to \requirement
			\ifeof\ownread
			\else
				\item \requirement \cite{\requirement}
			\fi
			\repeat
		\end{inparaitem}
		\closein\ownread
	}{File not found}
}

This chapter describes how to use the various components included in this
thesis.

\section{Building and Installation}
\subsection{Prerequisites}
\subsubsection{Python packages required}
To build, install and test the components of this project, the following
dependencies are required:
\piprequirements{requirements.txt}

\subsubsection{Apt packages required}
\piprequirements{apt_packages.txt}

\subsubsection{\LaTeX{} packages required}
\begin{itemize}
	\item Tikz-UML \cite{tikzuml}
\end{itemize}

\subsection{Building}
Once the repository is cloned, setup a build directory and invoke meson.
\begin{lstlisting}[language=bash]
cd /path/to/repository
mkdir build
cd build
meson ..
cd ..
\end{lstlisting}

The default build target will build the project, along with this thesis.
\begin{lstlisting}[language=bash]
ninja -C build
\end{lstlisting}

To run the tests, use \lstinline|ninja -C build test|.

\subsection{Installing}
Add \lstinline|suggest_names| to your \lstinline|PATH|.
\begin{lstlisting}[language=bash]
$ export PATH=/path/to/repository/suggest_names:$PATH
\end{lstlisting}


\section{Using}
\subsection{Generating the Variable Database}
Before any variable suggestions can be made, the source-code must be indexed.
This is achieved with a clang-plugin, that collects all variable occurences,
and information about them, such as type and name.

\subsubsection{Clang Invocation}
To generate a database for a given source file, run clang as follows:

\begin{lstlisting}[caption={Invocation of Clang}]
clang++ \
	-fplugin=/path/to/repository/build/libdump_names.so \
	-Xclang \
	-plugin-arg-dump-names \
	-Xclang \
	output-file \
	-Xclang \
	-plugin-arg-dump-names \
	-Xclang \
	/path/for/database \
	all... \
	other... \
	args... \
	/path/to/source.cpp
\end{lstlisting}

In the following sections we will refer to the following example piece of \CC{}
code:

\lstinputlisting[language=c++, numbers=left, caption=example.cpp]{example.cpp}

Running the Clang-plugin as described above will give us a JSON file containing
information on the symbols in the program:

\lstinputlisting[language=json, numbers=left, caption=varnames.json]
		{example.varnames.json}

By default, all filenames in the output are full paths. To make the output more
easily legible, we pass the \lstinline|-fdebug-prefix-map=/path/to/repository=.|
command-line argument to Clang, so that the output files are relative the root
of the repository.

\subsection{Generating Variable-name Suggestions}
Once the code-base is indexed, suggestions can be requested with the script
\lstinline|suggest_names|.

\lstinline|suggest_names|' documentation is as follows:
\lstinputlisting[caption={\lstinline|suggest_names --help|}]
	{suggest_names_help.txt}

Invoking \lstinline|suggest_names| to suggest an alternative to
\lstinline|Foo::id| can be done as follows:

\begin{lstlisting}
suggest_names varnames.json ./examples/example.cpp 2 9
\end{lstlisting}

The resulting suggestions are as follows:
\lstinputlisting[caption={Suggestions for \lstinline|Foo::id|}]
		{example_suggestions}

\subsection{Performing a Rename}
Renames can be performed with \lstinline|suggest_names_rename|.
The documentation for \lstinline|suggest_names_rename| is as follows:
\lstinputlisting[caption={\lstinline|suggest_names_rename --help|}]
		{suggest_names_rename_help.txt}

\subsection{Using the Vim Plugin}
To help making renaming easier, a Vim \cite{vim} plugin is included.
With it, the renaming process can be done interactively without needing to use
command-line tools.
The Vim plugin can be added to your \lstinline|.vimrc| by adding the following
two lines:

\begin{lstlisting}
set rtp+=/path/to/repository/vim
helptags /path/to/repository/vim/doc
\end{lstlisting}

Following this, the documentation of the Vim plugin is available through the
usual commands of Vim, such as \lstinline|:help|.

The output of querying the help for \lstinline|:help suggest-names.txt| can be
found in appendix \ref{appendix:vimplugindoc}.
